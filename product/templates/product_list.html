{% load static %}
<!DOCTYPE html>
<html lang="en">
   <head>
      <!-- basic -->
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <!-- mobile metas -->
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta name="viewport" content="initial-scale=1, maximum-scale=1">
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <!-- site metas -->
      <title>News</title>
      <meta name="keywords" content="">
      <meta name="description" content="">
      <meta name="author" content="">
      <!-- bootstrap css -->
      <link rel="stylesheet" type="text/css" href="{% static 'product/css/bootstrap.min.css' %}">
      <!-- style css -->
      <link rel="stylesheet" type="text/css" href="{% static 'product/css/style.css' %}">
      <link rel="stylesheet" type="text/css" href="{% static 'product/css/image.css' %}">
      <!-- Responsive-->
      <link rel="stylesheet" href="{% static 'product/css/responsive.css' %}">
      <!-- fevicon -->
      <link rel="icon" href="{% static 'product/images/fevicon.png' %}" type="image/gif" />
      <!-- Scrollbar Custom CSS -->
      <link rel="stylesheet" href="{% static 'product/css/jquery.mCustomScrollbar.min.css' %}">
      <!-- Tweaks for older IEs-->
      <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css">
      <!-- owl stylesheets --> 
      <link href="https://fonts.googleapis.com/css?family=Poppins:400,700|Raleway:400,700,800&display=swap" rel="stylesheet">
      <link rel="stylesheet" href="{% static 'product/css/owl.carousel.min.css' %}">
      <link rel="stylesoeet" href="{% static 'product/css/owl.theme.default.min.css' %}">
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.min.css" media="screen">
   </head>
   <body>
      <!-- header section start -->
      <div class="header_section header_bg">
         <nav class="navbar navbar-expand-lg navbar-light bg-light">
            <a href="index.html" class="logo"><img src="{% static 'product/images/logo.png' %}"></a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
               <ul class="navbar-nav mr-auto">
                  <li class="nav-item active">
                     <a class="nav-link" href={% url "index" %}>Home</a>
                  </li>
                  <li class="nav-item">
                     <a class="nav-link" href={% url "about_us" %}>About</a>
                  </li>
                  <li class="nav-item">
                     <a class="nav-link" href={% url "cycle" %}>Our Cycle</a>
                  </li>
                  <li class="nav-item">
                     <a class="nav-link" href="shop.html">Shop</a>
                  </li>
                  <li class="nav-item">
                     <a class="nav-link" href={% url "news" %}>News</a>
                  </li>
                  <li class="nav-item">
                     <a class="nav-link" href={% url "contact" %}>Contact Us</a>
                  </li>
                  <li class="nav-item">
                     <a class="nav-link" href={% url "cart" %}>CART {{ cart|length }}</a>
                  </li>
                  <li class="nav-item">
                     <a class="nav-link" href={% url "customer_panel" %} id="customer-panel-btn">Customer_panel</a>
                  </li>
                  <li class="nav-item">
                     <a class="nav-link" id='logoutLink' onclick="logoutFunc()">logout</a>
                  </li>
               </ul>
               <form class="form-inline my-2 my-lg-0" id="searchForm">
                  <div class="login_menu">
                     <ul>
                        <li>
                           <input type="text" id="searchInput" placeholder="Search...">
                           <button type="submit">search</button>
                           <ul id="productsList"></ul>
                        </li>
                        <li><a href={% url "login" %} id='loginLink'>Login</a></li>
                        <li><a href="#"><img src="{% static 'product/images/trolly-icon.png' %}"></a></li>
                     </ul>
                  </div>
               </form>
            </div>
            <div id="main">
               <span style="font-size:36px;cursor:pointer; color: #fff" onclick="openNav()"><img src="{% static 'product/images/toggle-icon.png' %}" style="height: 30px;"></span>
            </div>
         </nav>
         <!-- banner section start -->
         <div class="banner_section layout_padding">
            <div id="main_slider" class="carousel slide" data-ride="carousel">
               <div class="carousel-inner">
                  <div class="carousel-item active">
                     <div class="container">
                        <div class="row">
                           <div class="col-md-7">
                              <div class="best_text">Best</div>
                              <div class="image_1"><img src="{% static 'product/images/img-1.png' %}"></div>
                           </div>
                           <div class="col-md-5">
                              <h1 class="banner_taital">New Model Cycle</h1>
                              <p class="banner_text">It is a long established fact that a reader will be distracted by the readable content </p>
                              <div class="contact_bt"><a href="contact.html">Shop Now</a></div>
                           </div>
                        </div>
                     </div>
                  </div>
                  <div class="carousel-item">
                     <div class="container">
                        <div class="row">
                           <div class="col-md-7">
                              <div class="best_text">Best</div>
                              <div class="image_1"><img src="{% static 'product/images/img-1.png' %}"></div>
                           </div>
                           <div class="col-md-5">
                              <h1 class="banner_taital">New Model Cycle</h1>
                              <p class="banner_text">It is a long established fact that a reader will be distracted by the readable content </p>
                              <div class="contact_bt"><a href="contact.html">Shop Now</a></div>
                           </div>
                        </div>
                     </div>
                  </div>
                  <div class="carousel-item">
                     <div class="container">
                        <div class="row">
                           <div class="col-md-7">
                              <div class="best_text">Best</div>
                              <div class="image_1"><img src="{% static 'product/images/img-1.png' %}"></div>
                           </div>
                           <div class="col-md-5">
                              <h1 class="banner_taital">New Model Cycle</h1>
                              <p class="banner_text">It is a long established fact that a reader will be distracted by the readable content </p>
                              <div class="contact_bt"><a href="contact.html">Shop Now</a></div>
                           </div>
                        </div>
                     </div>
                  </div>
               </div>
               <a class="carousel-control-prev" href="#main_slider" role="button" data-slide="prev">
               <i class="fa fa-angle-left"></i>
               </a>
               <a class="carousel-control-next" href="#main_slider" role="button" data-slide="next">
               <i class="fa fa-angle-right"></i>
               </a>
            </div>
         </div>
         <!-- banner section end -->
      </div>
      <!-- header section end -->
      <!-- cycle section start -->
      <h1 class="cycle_taital">search cycle</h1>
      <div class="container" id='list-products'>
      </div>
      <div class="cycle_section layout_padding">
         <div class="container" id='list-product'>
            <h1 class="cycle_taital">Our cycle</h1>
            <p class="cycle_text">It is a long established fact that a reader will be distracted by the </p>
         </div>
      </div>
      <!-- cycle section end -->
      <!-- footer section start -->
      <div class="footer_section layout_padding">
         <div class="container-fluid">
            <div class="row">
               <div class="col-lg-8 col-sm-12 padding_0">
                  <div class="map_main">
                     <div class="map-responsive">
                       <iframe src="https://www.google.com/maps/embed/v1/place?key=AIzaSyA0s1a7phLN0iaD6-UE7m4qP-z21pH0eSc&amp;q=Eiffel+Tower+Paris+France" width="600" height="400" frameborder="0" style="border:0; width: 100%;" allowfullscreen=""></iframe>
                     </div>
                  </div>
               </div>
               <div class="col-lg-4 col-sm-12">
                  <div class="call_text"><a href="#"><img src="{% static 'images/map-icon.png' %}"><span class="padding_left_0">Page when looking at its layou</span></a></div>
                  <div class="call_text"><a href="#"><img src="{% static 'images/call-icon.png' %}"><span class="padding_left_0">Call Now  +01 123467890</span></a></div>
                  <div class="call_text"><a href="#"><img src="{% static 'images/mail-icon.png' %}"><span class="padding_left_0">demo@gmail.com</span></a></div>
                  <input type="text" class="email_text" placeholder="Enter Your Email" name="Enter Your Email">
                  <div class="subscribe_bt"><a href="#">Subscribe</a></div>
               </div>
            </div>
         </div>
      </div>
      <!-- footer section end -->
      <!-- copyright section start -->
      <div class="copyright_section">
         <div class="container">
            <p class="copyright_text">Copyright 2019 All Right Reserved By.<a href="https://html.design"> Free  html Templates</p>
         </div>
      </div>
      <!-- copyright section end -->    
      <!-- Javascript files-->
      <script src="{% static 'product/js/jquery.min.js' %}"></script>
      <script src="{% static 'product/js/popper.min.js' %}"></script>
      <script src="{% static 'product/js/bootstrap.bundle.min.js' %}"></script>
      <script src="{% static 'product/js/jquery-3.0.0.min.js' %}"></script>
      <script src="{% static 'product/js/plugin.js' %}"></script>
      <!-- sidebar -->
      <script src="{% static 'product/js/jquery.mCustomScrollbar.concat.min.js' %}"></script>
      <script src="{% static 'product/js/custom.js' %}"></script>
      <!-- javascript --> 
      <script src="{% static 'product/js/owl.carousel.js' %}"></script>
      <script src="{% static 'https:cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.min.js' %}"></script>
      <script>
         function openNav() {
           document.getElementById("mySidenav").style.width = "250px";
           document.getElementById("main").style.marginLeft = "250px";
         }
         
         function closeNav() {
           document.getElementById("mySidenav").style.width = "0";
           document.getElementById("main").style.marginLeft= "0";
          
         }

         $("#main").click(function(){
             $("#navbarSupportedContent").toggleClass("nav-normal")
         })

         fetch('/api'+window.location.pathname)
         .then(response => response.json())
         .then(data => {
            console.log("hossein")
             var productList = $('#list-product');
             data.products.forEach(function(product) {200
                 productList.append('<div class="cycle_section_2 layout_padding"><div class="row"><div class="col-md-6"><div class="box_main"><h6 class="number_text">01</h6><div class="image_2"><img class="product-image" src='+product.image+'></div></div></div><div class="col-md-6"><h1 class="cycles_text">'+product.name+'</h1><p class="lorem_text">'+product.description+'</p><div class="btn_main"><div class="buy_bt"><a href="/product_detail/' + product.slug + '/">product details</a></div><h4 class="price_text"> <span style=" color: #f7c17b">$</span> <span style=" color: #325662">'+product.price+'</span></h4></div></div></div></div>');});})
                 .catch(error => console.error('Error:', error)); 
                 document.getElementById('customer-panel-btn').addEventListener('click', function(event) {
                  event.preventDefault(); // Prevent the default action of the link
              
                  // Check if the user is logged in
                  if (!isLoggedIn()) {
                      // If not logged in, show error message and redirect to login page
                      alert('You need to login to proceed to checkout.');
                      window.location.href = "{% url 'login' %}";
                  } else {
                      // If logged in, proceed to checkout page
                      window.location.href = "{% url 'customer_panel' %}";
                  }
              });
              
              // Function to check if the user is logged in
              function isLoggedIn() {
                  // Implement your logic to check if the user is logged in
                  // For example, you can check if there's a token stored in localStorage
                  return localStorage.getItem('accessToken') == null;
              }

           document.addEventListener("DOMContentLoaded", function() {
            var loginLink = document.getElementById('loginLink');
            var logoutLink = document.getElementById('logoutLink');

            // Check if access token exists in localStorage
            if (localStorage.getItem('access_token')) {
               // Access token exists, hide login link and show logout link
               loginLink.style.display = 'none';
               logoutLink.style.display = 'block';
            } else {
               // Access token doesn't exist, show login link and hide logout link
               loginLink.style.display = 'block';
               logoutLink.style.display = 'none';
            }
      });

      // Function to logout and remove access token from localStorage
            function logoutFunc() {
                  localStorage.removeItem("access_token");
                  window.location.reload(); // Reload the page to reflect changes
            }
      
         // Function to search products using AJAX
         async function fetchProducts(searchTerm) {
            searchTerm=document.getElementById('searchInput').value
            console.log(searchTerm)
            const url = `/api/search?search=${searchTerm}`;
            const response = await fetch(url);
            console.log('jiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiii')
            return response.json();
        }

        // Function to update the UI with the fetched products
        function updateUI(products) {
         var productList = $('#list-products');
         productList.empty();
         if (document.getElementById('searchInput').value !== '') {
         products.forEach(product => {
               productList.append('<div class="cycle_section_2 layout_padding"><div class="row"><div class="col-md-6"><div class="box_main"><h6 class="number_text">01</h6><div class="image_2"><img class="product-image" src='+product.image+'></div></div></div><div class="col-md-6"><h1 class="cycles_text">'+product.name+'</h1><p class="lorem_text">'+product.description+'</p><div class="btn_main"><div class="buy_bt"><a href="/product_detail/' + product.slug + '/">product details</a></div><h4 class="price_text"> <span style=" color: #f7c17b">$</span> <span style=" color: #325662">'+product.price+'</span></h4></div></div></div></div>')
               .catch(error => console.error('Error:', error)); 
            })};
        }

        // Event listener for search input
        document.getElementById('searchInput').addEventListener('input', function() {
            const searchTerm = this.value.trim();
            fetchProducts(searchTerm)
                .then(products => updateUI(products))
                .catch(error => console.error('Error fetching products:', error));
        });

        // Initial fetch on page load
        window.onload = function() {
            fetchProducts('')
                .then(products => updateUI(products))
                .catch(error => console.error('Error fetching products:', error));
        };
        document.getElementById('searchForm').addEventListener('submit', function(event) {
         event.preventDefault(); // جلوگیری از عملکرد پیش‌فرض فرم
         
         // انجام جستجو فقط اگر مقدار ورودی سرچ خالی نباشد
         const searchTerm = document.getElementById('searchInput').value.trim();
         if (searchTerm !== '') {
             fetchProducts(searchTerm)
                 .then(products => updateUI(products))
                 .catch(error => console.error('Error fetching products:', error));
         }
      });
      </script>
   </body>
</html>
