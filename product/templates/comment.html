{% load static %}
<body>
	<link href='https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css' rel="stylesheet">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js" rel="stylesheet">
	<link href="{% static 'https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css' %}" rel="stylesheet">
	<link href="{% static 'comment/comment.css' %}" rel="stylesheet"> 
	<div class="container">
	<div class="be-comment-block">
		<div class="be-comment-block" id='comment-list'>
		<h1 class="comments-title">Comments (3)</h1>
		<div class="be-comment">
			<div class="be-img-comment">	
				<a href="blog-detail-2.html">
					<img src="https://bootdey.com/img/Content/avatar/avatar1.png" alt="" class="be-ava-comment">
				</a>
			</div>
			<div class="be-comment-content">
				
					<span class="be-comment-name">
						<a href="blog-detail-2.html">Ravi Sah</a>
						</span>
					<span class="be-comment-time">
						<i class="fa fa-clock-o"></i>
						May 27, 2015 at 3:14am
					</span>
	
				<p class="be-comment-text">
					Pellentesque gravida tristique ultrices. 
					Sed blandit varius mauris, vel volutpat urna hendrerit id. 
					Curabitur rutrum dolor gravida turpis tristique efficitur.
				</p>
			</div>
		</div>
		<div class="be-comment">
			<div class="be-img-comment">	
				<a href="blog-detail-2.html">
					<img src="https://bootdey.com/img/Content/avatar/avatar2.png" alt="" class="be-ava-comment">
				</a>
			</div>
			<div class="be-comment-content">
				<span class="be-comment-name">
					<a href="blog-detail-2.html">Phoenix, the Creative Studio</a>
				</span>
				<span class="be-comment-time">
					<i class="fa fa-clock-o"></i>
					May 27, 2015 at 3:14am
				</span>
				<p class="be-comment-text">
					Nunc ornare sed dolor sed mattis. In scelerisque dui a arcu mattis, at maximus eros commodo. Cras magna nunc, cursus lobortis luctus at, sollicitudin vel neque. Duis eleifend lorem non ant. Proin ut ornare lectus, vel eleifend est. Fusce hendrerit dui in turpis tristique blandit.
				</p>
			</div>
		</div>
		<div class="be-comment">
			<div class="be-img-comment">	
				<a href="blog-detail-2.html">
					<img src="https://bootdey.com/img/Content/avatar/avatar3.png" alt="" class="be-ava-comment">
				</a>
			</div>
			<div class="be-comment-content">
				<span class="be-comment-name">
					<a href="blog-detail-2.html">Cüneyt ŞEN</a>
				</span>
				<span class="be-comment-time">
					<i class="fa fa-clock-o"></i>
					May 27, 2015 at 3:14am
				</span>
				<p class="be-comment-text">
					Cras magna nunc, cursus lobortis luctus at, sollicitudin vel neque. Duis eleifend lorem non ant
				</p>
			</div>
		</div>
		</div>
		<form class="form-block" id="myForm" method="post" action="{% url 'post_comment' %}">
			{% csrf_token %}
			<div class="row">
				<div class="col-xs-12 col-sm-6 fl_icon">
					<div class="form-group fl_icon">
						<div class="icon"><i class="fa fa-envelope-o"></i></div>
						<input class="form-input" type="text" placeholder="Product name" name="name">
					</div>
				</div>
				<div class="col-xs-12">									
					<div class="form-group">
						<textarea class="form-input" required="" placeholder="Your text" name="text_message"></textarea>
					</div>
				</div>
				<button id="saveAddressBtn" class="btn btn-primary d-block btn-user w-100" type="submit">Save comment</button>
			</div>
		</form>
	</div>
	</div>
	<script>
		fetch('/api' + window.location.pathname)
		.then(response => response.json())
		.then(data => {
			const productList = document.getElementById('comment-list');
			// خالی کردن المان محتوا
			productList.innerHTML = '';
	
			data.comment.forEach(function (product) {
				// ایجاد المان جدید
				const commentContainer = document.createElement('div');
				commentContainer.classList.add('be-comment');
	
				commentContainer.innerHTML = `
					<div class="be-img-comment">	
						<a href="blog-detail-2.html">
							<img src="${product.user_id.image}" alt="" class="be-ava-comment">
						</a>
					</div>
					<div class="be-comment-content">	
						<span class="be-comment-name">
							<a href="blog-detail-2.html">${product.user_id.first_name}</a>
						</span>
						<span class="be-comment-time">
							<i class="fa fa-clock-o"></i>
							${product.created_at}
						</span>
						<p class="be-comment-text">
							${product.text_message}
						</p>
					</div>
				`;
				
				// اضافه کردن المان جدید به لیست محصولات
				productList.appendChild(commentContainer);
			});
		})
		.catch(error => console.error('Error:', error)); 
		function saveAddress() {
			const formData = new FormData(document.getElementById("myForm"));
			const data = {};
			formData.forEach((value, key) => {
				data[key] = value;
			});
			const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;
			fetch('api/post_comment/', {
				method: 'POST',
				headers: {
					'Content-Type': 'application/json',
					'X-CSRFToken': csrftoken
				},
				body: JSON.stringify(data),
			})
			.then(response => {
				if (!response.ok) {
					throw new Error('Network response was not ok');
				}
				return response.json();
			})
			.then(data => {
				alert('Comment created successfully');
				console.log(data);
			})
			.catch(error => {
				alert('There was a problem creating the Comment');
				console.error('Error:', error);
			});
		}
	</script>
</body>